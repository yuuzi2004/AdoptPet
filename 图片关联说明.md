# 宠物图片关联操作说明

## 已完成的工作

### 1. 图片文件准备
- ✅ 已将 `photo` 文件夹中的4张图片复制到 `src/main/webapp/uploads/` 目录：
  - 小白.jpg
  - 旺财.jpg
  - 小花.jpg
  - 小黑.jpg

### 2. 代码修改
- ✅ 修复了 `list.jsp` 中的图片显示逻辑，确保正确显示数据库中的图片
- ✅ 修复了 `detail.jsp` 中的图片显示逻辑
- ✅ 修复了 `edit-pet.jsp` 中的图片显示路径
- ✅ 修复了 `AdminPetUpdateServlet` 中的图片上传逻辑

### 3. 数据库更新脚本
- ✅ 创建了 `database_update_pet_images.sql` 脚本，用于将图片路径关联到数据库

## 操作步骤

### 第一步：执行数据库更新脚本

在MySQL数据库中执行 `database_update_pet_images.sql` 脚本：

```sql
-- 方法1：使用MySQL命令行
mysql -u 用户名 -p 数据库名 < database_update_pet_images.sql

-- 方法2：在MySQL客户端中直接执行脚本内容
USE `pet_adopt`;

UPDATE `pet` SET `image_path` = 'uploads/小白.jpg' WHERE `name` = '小白';
UPDATE `pet` SET `image_path` = 'uploads/旺财.jpg' WHERE `name` = '旺财';
UPDATE `pet` SET `image_path` = 'uploads/小花.jpg' WHERE `name` = '小花';
UPDATE `pet` SET `image_path` = 'uploads/小黑.jpg' WHERE `name` = '小黑';
```

### 第二步：验证数据库更新

执行以下SQL查询，确认图片路径已正确更新：

```sql
SELECT id, name, type, image_path FROM `pet` ORDER BY id;
```

应该看到类似以下的结果：
```
+----+--------+------+------------------+
| id | name   | type | image_path       |
+----+--------+------+------------------+
|  1 | 小白   | 猫   | uploads/小白.jpg |
|  2 | 旺财   | 狗   | uploads/旺财.jpg |
|  3 | 小花   | 猫   | uploads/小花.jpg |
|  4 | 小黑   | 狗   | uploads/小黑.jpg |
+----+--------+------+------------------+
```

### 第三步：重新部署应用

1. 重新编译项目（如果使用Maven：`mvn clean package`）
2. 重启Tomcat服务器
3. 访问宠物列表页面，验证图片是否正确显示

## 图片上传功能说明

### 用户上传图片
- 用户在发布宠物信息时（`add.jsp`），可以选择上传图片
- 上传的图片会自动保存到 `uploads` 目录
- 图片路径会保存到数据库的 `image_path` 字段

### 管理员调整图片
- 管理员可以在编辑宠物信息时（`edit-pet.jsp`）更换图片
- 新上传的图片会替换旧图片
- 图片路径会自动更新到数据库

## 图片访问路径

图片通过 `ImageServlet` 访问，路径格式为：
- `${pageContext.request.contextPath}/uploads/文件名`

例如：
- `/Pet1.0/uploads/小白.jpg`
- `/Pet1.0/uploads/旺财.jpg`

## 注意事项

1. **图片路径格式**：数据库中的 `image_path` 字段存储的是相对于 `webapp` 目录的路径，格式为 `uploads/文件名.jpg`

2. **图片不存在时的处理**：
   - 如果图片路径为空，会显示占位图片
   - 如果图片文件不存在，会显示错误占位图片

3. **文件大小限制**：上传的图片最大为 5MB

4. **支持的文件格式**：JPG、PNG、GIF、WEBP

## 故障排查

### 问题1：图片不显示
- 检查 `uploads` 目录是否存在
- 检查图片文件是否已复制到 `uploads` 目录
- 检查数据库中的 `image_path` 字段是否正确
- 检查 `ImageServlet` 是否正确配置

### 问题2：图片上传失败
- 检查文件大小是否超过 5MB
- 检查文件格式是否支持
- 检查 `uploads` 目录的写入权限

### 问题3：数据库更新失败
- 确认数据库连接正常
- 确认宠物名称与数据库中的记录完全匹配（注意中文字符）
- 检查 `pet` 表是否存在 `image_path` 字段（如果不存在，先执行 `database_update_image.sql`）

## 后续扩展

如果需要添加更多宠物图片：
1. 将图片复制到 `src/main/webapp/uploads/` 目录
2. 在数据库中更新对应宠物的 `image_path` 字段
3. 或者通过管理员后台编辑功能上传新图片

