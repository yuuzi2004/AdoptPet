# 数据库连接问题排查指南

## 问题现象
访问页面时出现错误：`获取数据库连接失败！`

## 解决步骤

### 方法一：使用 Navicat（推荐，图形化界面）

1. **打开 Navicat**
   - 启动 Navicat Premium 或 Navicat for MySQL

2. **检查 MySQL 服务是否运行**
   - 在 Navicat 中点击"连接" → "MySQL"
   - 输入连接信息：
     - 主机：`localhost` 或 `127.0.0.1`
     - 端口：`3306`
     - 用户名：`root`
     - 密码：`HE04140626`（根据你的实际密码修改）
   - 点击"测试连接"
   - 如果连接失败，说明 MySQL 服务未启动或密码错误

3. **启动 MySQL 服务**（如果未运行）
   - Windows: 打开"服务"（services.msc），找到 MySQL 服务，右键"启动"
   - 或在命令行执行：`net start MySQL`（服务名可能不同）

4. **创建数据库**
   - 在 Navicat 中连接到 MySQL
   - 右键点击连接 → "新建数据库"
   - 数据库名：`pet_adopt`
   - 字符集：`utf8mb4`
   - 排序规则：`utf8mb4_unicode_ci`
   - 点击"确定"

5. **执行 SQL 脚本**
   - 在 Navicat 中打开 `database_init.sql` 文件
   - 或直接复制脚本内容到查询窗口
   - 点击"运行"执行脚本
   - 这会创建 `pet` 表并插入测试数据

### 方法二：使用命令行（MySQL 客户端）

1. **打开命令提示符或 PowerShell**

2. **登录 MySQL**
   ```bash
   mysql -u root -p
   ```
   输入密码：`HE04140626`

3. **执行初始化脚本**
   ```bash
   source E:\java\AdoptPet\database_init.sql
   ```
   或直接复制 SQL 语句到 MySQL 命令行执行

4. **验证数据库和表**
   ```sql
   USE pet_adopt;
   SHOW TABLES;
   SELECT * FROM pet;
   ```

### 方法三：检查配置文件

检查 `src/main/resources/db.properties` 文件：

```properties
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/pet_adopt?useUnicode=true&characterEncoding=utf8&serverTimezone=UTC
jdbc.username=root
jdbc.password=HE04140626
```

**如果密码不同，请修改 `jdbc.password` 的值**

## 常见问题

### 1. MySQL 服务未启动
**错误信息**：`Communications link failure` 或 `Connection refused`

**解决方法**：
- Windows: 打开"服务"，启动 MySQL 服务
- 检查 MySQL 是否安装：`mysql --version`

### 2. 数据库不存在
**错误信息**：`Unknown database 'pet_adopt'`

**解决方法**：
- 执行 `database_init.sql` 脚本创建数据库

### 3. 用户名或密码错误
**错误信息**：`Access denied for user 'root'@'localhost'`

**解决方法**：
- 检查 `db.properties` 中的用户名和密码是否正确
- 在 Navicat 中测试连接确认密码

### 4. 端口错误
**错误信息**：`Connection refused` 或 `Connection timed out`

**解决方法**：
- 检查 MySQL 实际端口（默认 3306）
- 如果端口不同，修改 `db.properties` 中的 URL

### 5. 时区问题
**错误信息**：`The server time zone value 'xxx' is unrecognized`

**解决方法**：
- URL 中已包含 `serverTimezone=UTC`，通常可以解决
- 如果还有问题，可以改为 `serverTimezone=Asia/Shanghai`

## 验证连接

执行以下步骤验证：

1. **重新编译项目**
   ```bash
   mvn clean compile
   ```

2. **重新部署到 Tomcat**

3. **访问页面**
   - 访问：`http://localhost:8080/Pet1.0/pet/list`
   - 应该能看到宠物列表（如果有数据）或空列表

4. **查看 Tomcat 日志**
   - 如果还有错误，查看 `catalina.out` 或控制台日志
   - 现在会显示更详细的错误信息

## 测试数据

执行 `database_init.sql` 后，数据库中会有 4 条测试数据：
- 小白（猫）
- 旺财（狗）
- 小花（猫）
- 小黑（狗）

访问列表页面应该能看到这些数据。

